{
  "active": false,
  "connections": {
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Item Lists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking \"Execute Workflow\"": {
      "main": [
        [
          {
            "node": "Postgres5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "IF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF1": {
      "main": [
        [],
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Bitrix24_ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bitrix24_ID": {
      "main": [
        [
          {
            "node": "Get Contacts1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Contacts1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Item Lists": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Postgres1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres5": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Item Lists1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF2": {
      "main": [
        [
          {
            "node": "HTTP Request6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Item Lists1": {
      "main": [
        [
          {
            "node": "IF2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "HTTP Request6": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2023-12-14T18:17:34.078Z",
  "id": "g5t2I8YJeiCd5cxN",
  "isArchived": false,
  "meta": null,
  "name": "Update Patient Delta",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://nmnepic.bitrix24.com/rest/229/ovmu87rocingpwzg/crm.contact.list.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "start",
              "value": "={{ $json.start }}"
            },
            {
              "name": "count",
              "value": "50"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {}
          }
        }
      },
      "id": "77896866-acdb-4ddd-81c3-0174ea87b272",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1060,
        940
      ]
    },
    {
      "parameters": {},
      "id": "3aed8a3b-63f3-46ae-8155-c76f97477778",
      "name": "When clicking \"Execute Workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        460,
        620
      ]
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "start",
              "type": "numberValue",
              "numberValue": "={{ $json.next }}"
            }
          ]
        },
        "include": "none",
        "options": {}
      },
      "id": "a059cfed-c640-40dc-a438-ea1eb7e88d8b",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        1360,
        940
      ]
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "total",
              "stringValue": "={{ $json.total }}"
            }
          ]
        },
        "include": "none",
        "options": {}
      },
      "id": "42df8462-ebe9-4b09-a37b-ae49e3d568ce",
      "name": "Edit Fields1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        1360,
        1100
      ]
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "id": "39911aca-e27a-45a5-a16d-f7c19b6ee92a",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        1600,
        1020
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.total }}",
              "value2": "={{ $json.start }}"
            }
          ]
        },
        "combineConditions": "OR"
      },
      "id": "15e25fab-5362-4a11-bcfb-fba0137ba100",
      "name": "Filter",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 1,
      "position": [
        2020,
        1100
      ]
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "start",
              "type": "numberValue",
              "numberValue": "=0"
            }
          ]
        },
        "include": "none",
        "options": {}
      },
      "id": "449123e0-71d1-4468-b8ac-bba4ae0b2255",
      "name": "Start",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        640,
        920
      ]
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "start",
              "type": "numberValue",
              "numberValue": "={{ $json.start }}"
            }
          ]
        },
        "include": "none",
        "options": {}
      },
      "id": "a43e4b67-376f-44cd-8df8-e53b1d19048e",
      "name": "Edit Fields2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        860,
        940
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.start }}",
              "operation": "isEmpty"
            }
          ]
        },
        "combineOperation": "any"
      },
      "id": "6e8a8ff9-49b4-4700-ae1f-a246854d6721",
      "name": "IF1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1760,
        1020
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "result",
        "options": {}
      },
      "id": "e2b1038d-84cb-47e6-a811-4ff74c5aff96",
      "name": "Item Lists",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        1360,
        640
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://nmnepic.bitrix24.com/rest/7/7ph530802yz1xd35/crm.contact.update.json",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={     \n\"id\": {{ $json[\"result\"][\"ID\"] }},\n\"fields\": { \"SOURCE_DESCRIPTION\": \"{{ $json[\"result\"][\"UF_CRM_1699956282\"] }}\"}\n }",
        "options": {
          "batching": {
            "batch": {
              "batchSize": 0,
              "batchInterval": 200
            }
          }
        }
      },
      "id": "ff86eb1b-8965-4da3-929c-507a628064db",
      "name": "HTTP Request2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2380,
        640
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://nmnepic.bitrix24.com/rest/7/7ph530802yz1xd35/crm.contact.get.json?ID={{ $json.ID }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "value": "={{ $('Item Lists').item.json.ID }}"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {
              "batchSize": 0,
              "batchInterval": 200
            }
          }
        }
      },
      "id": "7b76912c-8a14-4b7e-a6f8-3cf6c73f4a03",
      "name": "HTTP Request3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1800,
        640
      ]
    },
    {
      "parameters": {
        "unit": "seconds"
      },
      "id": "42aa24ec-5e4e-4f28-a5d6-5d56c6c778ec",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        2240,
        1100
      ],
      "webhookId": "e0d2529c-9458-4c2a-aa5e-34898f48b65e"
    },
    {
      "parameters": {
        "unit": "seconds"
      },
      "id": "5243cd5b-92eb-4c56-9043-778ec6c9380a",
      "name": "Wait1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        2060,
        640
      ],
      "webhookId": "ad0db83d-d0ac-4aae-a34f-739e18a6a9ec",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.SOURCE_DESCRIPTION }}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "id": "d9b2505d-575b-45d7-ad32-f2664fc8efd1",
      "name": "IF",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1580,
        640
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "cfa54d72-e385-430b-97aa-7b338b80e08c",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "ebcb7622-42a5-4c80-a2b6-08579fd88f4d",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        100,
        -760
      ],
      "webhookId": "71723600-50b4-4691-b393-35c376f52da2",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "= {{ $json.body.PLACEMENT_OPTIONS }}",
        "include": "none",
        "options": {}
      },
      "id": "535f60f5-91cc-4c82-b661-3c28c690a658",
      "name": "Bitrix24_ID",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.1,
      "position": [
        740,
        -760
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<html> <body> {{ $json.result.LAST_NAME }}, {{ $json.result.NAME }}\n<br>User has been updated! Please refresh the page.\n<br>\n<br>Here is other relevant information about the user for quick reference\n<script type=\"text/javascript\">\n  (function(d, t) {\n      var v = d.createElement(t), s = d.getElementsByTagName(t)[0];\n      v.onload = function() {\n        window.voiceflow.chat.load({\n          verify: { projectID: '645a9f82ae0c18000706e0be' },\n          url: 'https://general-runtime.voiceflow.com',\n          versionID: 'production'\n        });\n      }\n      v.src = \"https://cdn.voiceflow.com/widget/bundle.mjs\"; v.type = \"text/javascript\"; s.parentNode.insertBefore(v, s);\n  })(document, 'script');\n</script> </body> </html>",
        "options": {}
      },
      "id": "59e2e613-efbe-4899-9dc2-3b6d6f22e933",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1340,
        -760
      ]
    },
    {
      "parameters": {
        "url": "https://nmnepic.bitrix24.com/rest/7/7ph530802yz1xd35/crm.contact.get.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "={{ $json.ID }}"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {
              "batchSize": 50000
            }
          }
        }
      },
      "id": "f6f8eedc-4751-4d83-ace6-5228d1d50f74",
      "name": "Get Contacts1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        960,
        -760
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM public.deltadata FETCH FIRST ROW ONLY;\n",
        "options": {}
      },
      "id": "00685b3c-9868-4da7-a85b-c14ed34ea35f",
      "name": "Postgres5",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -600,
        20
      ],
      "credentials": {
        "postgres": {
          "id": "Q6RIpOzlSExUJy1c",
          "name": "Postgres n8nautoxl"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "aduserlogs",
          "mode": "list",
          "cachedResultName": "aduserlogs"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.ID }}",
            "name": "={{ $json.NAME }}",
            "second_name": "={{ $json.SECOND_NAME }}",
            "last_name": "={{ $json.LAST_NAME }}",
            "source_description": "={{ $json.SOURCE_DESCRIPTION }}",
            "birthday": "={{ $json.BIRTHDATE }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "post",
              "displayName": "post",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "honorific",
              "displayName": "honorific",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "last_name",
              "displayName": "last_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "source_description",
              "displayName": "source_description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "birthday",
              "displayName": "birthday",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "a53c40dc-0eb1-4eec-b6d7-cab0fe947f8f",
      "name": "Postgres",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1940,
        200
      ],
      "credentials": {
        "postgres": {
          "id": "6evGB8oNYEOyTU8b",
          "name": "Postgres HR"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "ALTER TABLE aduserlogs\n--ADD COLUMN ID VARCHAR(255),\nADD COLUMN POST VARCHAR(255),\nADD COLUMN COMMENTS VARCHAR(255),\nADD COLUMN HONORIFIC VARCHAR(255),\nADD COLUMN NAME VARCHAR(255),\nADD COLUMN LAST_NAME VARCHAR(255),\n--ADD COLUMN LEAD_ID VARCHAR(255),\n--ADD COLUMN TYPE_ID VARCHAR(255),\n--ADD COLUMN SOURCE_ID VARCHAR(255),\nADD COLUMN SOURCE_DESCRIPTION VARCHAR(255),\nADD COLUMN BIRTHDAY VARCHAR(255);\n--ADD COLUMN lastLogoff VARCHAR(255);\n",
        "options": {}
      },
      "id": "f926d3b8-83a0-46a0-bb61-7efce1417172",
      "name": "SET Columns",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        2460,
        -460
      ],
      "credentials": {
        "postgres": {
          "id": "6evGB8oNYEOyTU8b",
          "name": "Postgres HR"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM aduserlogs;",
        "options": {}
      },
      "id": "73be3ab7-d00d-4195-b57e-5fe3a6125a63",
      "name": "Get all records",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        2460,
        -280
      ],
      "credentials": {
        "postgres": {
          "id": "6evGB8oNYEOyTU8b",
          "name": "Postgres HR"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "aduserlogs",
          "mode": "list",
          "cachedResultName": "aduserlogs"
        },
        "options": {}
      },
      "id": "9f5f9b6d-2ed7-4e64-a3c9-b2b24eee0b2b",
      "name": "Remove all records",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        2460,
        -100
      ],
      "credentials": {
        "postgres": {
          "id": "6evGB8oNYEOyTU8b",
          "name": "Postgres HR"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE aduserlogs (\nID VARCHAR(255)\n);",
        "options": {}
      },
      "id": "aca2f3c1-2a9f-4840-acaa-60cf97149519",
      "name": "SET Columns1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        2260,
        -460
      ],
      "credentials": {
        "postgres": {
          "id": "6evGB8oNYEOyTU8b",
          "name": "Postgres HR"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "include": "selected",
        "includeFields": "ID,NAME,LAST_NAME,SOURCE_DESCRIPTION,BIRTHDATE",
        "options": {}
      },
      "id": "1659fd5b-da4b-420c-bc15-b1e6e6524d94",
      "name": "Edit Fields3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        1620,
        300
      ]
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "aduserlogs",
          "mode": "list",
          "cachedResultName": "aduserlogs"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.ID }}",
            "name": "={{ $json.NAME }}",
            "second_name": "={{ $json.SECOND_NAME }}",
            "last_name": "={{ $json.LAST_NAME }}",
            "source_description": "={{ $json.SOURCE_DESCRIPTION }}",
            "birthday": "={{ $json.BIRTHDATE }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "post",
              "displayName": "post",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "honorific",
              "displayName": "honorific",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "last_name",
              "displayName": "last_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "source_description",
              "displayName": "source_description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "birthday",
              "displayName": "birthday",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {
          "skipOnConflict": true,
          "replaceEmptyStrings": true
        }
      },
      "id": "75fd2694-87d1-43cf-a927-6d2ab0ab5622",
      "name": "Postgres1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1940,
        340
      ],
      "credentials": {
        "postgres": {
          "id": "6evGB8oNYEOyTU8b",
          "name": "Postgres HR"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "ALTER TABLE aduserlogs\n--ADD COLUMN ID VARCHAR(255),\nADD COLUMN SECOND_NAME VARCHAR(255);\n--ADD COLUMN lastLogoff VARCHAR(255);\n",
        "options": {}
      },
      "id": "776a8741-5f16-487f-b670-13d4e5a4a3e3",
      "name": "SET Columns2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        2640,
        -460
      ],
      "credentials": {
        "postgres": {
          "id": "6evGB8oNYEOyTU8b",
          "name": "Postgres HR"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "height": 656.2051282051286,
        "width": 753.1487179487175
      },
      "id": "85151884-a064-421a-8368-159326a59707",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2100,
        -560
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://nmnepic.bitrix24.com/rest/229/ovmu87rocingpwzg/crm.contact.list.json",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={     \"filter\": { \"SOURCE_DESCRIPTION\": \"{{ $json[\"MRN\"] }}\" } }",
        "options": {}
      },
      "id": "e5ac34e2-0e5e-4385-9562-9ceb8861e570",
      "name": "HTTP Request1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -360,
        -160
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.total }}",
              "operation": "equal",
              "value2": 1
            }
          ]
        }
      },
      "id": "74b577c1-e07a-4815-873c-9173ea594d6c",
      "name": "IF2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        20,
        -160
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByPosition",
        "options": {}
      },
      "id": "e26d3231-d95c-4f94-a138-fcb40eac74cf",
      "name": "Merge1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        700,
        40
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "01e799da-f30a-41fc-9976-5f92e2929634",
      "name": "HTTP Request4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        420,
        -520
      ],
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://nmnepic.bitrix24.com/rest/7/7ph530802yz1xd35/crm.contact.update.json",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n   \"ID\": {{ $json[\"Bitrix24ID\"] }},\n   \"fields\": {\n        \"NAME\": \"{{ $json[\"First Name\"] }}\",\n        \"LAST_NAME\": \"{{ $json[\"Last Name\"] }}\",\n        \"SOURCE_DESCRIPTION\": \"{{ $json[\"Source information\"] }}\",\n        \"BIRTHDATE\": \"1994-11-07T03:00:00+03:00\",\n        \"UF_CRM_65264864F0B8D\": [],\n        \"UF_CRM_1701895631\": \"{{ $json[\"Street\"] }}\",\n        \"UF_CRM_1701895642\": \"{{ $json[\"City\"] }}\",\n        \"UF_CRM_1701895652\": \"{{ $json[\"State\"] }}\",\n        \"UF_CRM_1701895672\": \"{{ $json[\"ZipCode\"] }}\",\n        \"UF_CRM_1701895781\": \"{{ $json[\"MRN\"] }}\",\n        \"UF_CRM_1701945675\": \"2009-07-20T03:00:00+04:00\",\n        \"UF_CRM_1701945715\": \"{{ $json[\"Patient_ActiveOrInactive_InPMSystem\"] }}\",\n        \"UF_CRM_1701945745\": \"{{ $json[\"Guarantor_LastFirstName\"] }}\",\n        \"UF_CRM_1701945783\": \"{{ $json[\"Guarantor_Mobile\"]}}\",\n        \"UF_CRM_1701945802\": \"{{ $json[\"Guarantor_HomePhone\"]}}\",\n        \"UF_CRM_1701945925\": \"\",\n        \"UF_CRM_1701946007\": \"{{ $json[\"Total_Prior_AcknowledgedAppts\"] }}\",\n        \"UF_CRM_1701946033\": \"2020-04-29T03:00:00+03:00\",\n        \"UF_CRM_1701946094\": \"{{ $json[\"Show_rate_percentage\"] }}\",\n        \"UF_CRM_1701946120\": \"2020-04-29T03:00:00+03:00\",\n        \"UF_CRM_1701946151\": \"{{ $json[\"Last_Appointment_Provider_Seen\"] }}\",\n        \"UF_CRM_1701946169\": \"{{ $json[\"Last_Appointment_Location_Visited\"]}}\",\n        \"UF_CRM_1701946191\": \"{{ $json[\"Carrier_InsurancePlan_Name\"] }}\",\n        \"UF_CRM_1701946209\": \"{{ $json[\"preferred_provider\"]}}\",\n        \"UF_CRM_1701946229\": \"01/01/1900\",\n        \"UF_CRM_1701946345\": \"3\",\n        \"UF_CRM_1701946367\": \"0\",\n        \"UF_CRM_1701946388\": \"{{ $json[\"CCM_Username\"]}}\",\n        \"UF_CRM_1701946429\": \"1900-01-01T03:00:00+02:30\",\n        \"UF_CRM_1701946464\": \"1900-01-01T03:00:00+02:30\",\n        \"UF_CRM_1701946899166\": \"\",\n        \"UF_CRM_1701946956633\": \"\",\n        \"UF_CRM_652648651AA54\": [],\n        \"UF_CRM_6526486522D7A\": \"\",\n        \"UF_CRM_652648652C199\": \"\",\n        \"UF_CRM_6526486538EE1\": \"\",\n        \"UF_CRM_6526486540168\": \"\",\n        \"UF_CRM_6526486549778\": \"\",\n        \"UF_CRM_6526486552DF7\": \"\",\n        \"UF_CRM_652648655AF1A\": \"\",\n        \"PHONE\": [\n            {\n                \"ID\": \"{{ $json[\"Phone\"] }}\",\n                \"VALUE_TYPE\": \"MOBILE\",\n                \"VALUE\": \"{{ $json[\"Phone_Mobile\"]}}\",\n                \"TYPE_ID\": \"PHONE\"\n            },\n            {\n                \"ID\": \"{{ $json[\"Phone1\"] }}\",\n                \"VALUE_TYPE\": \"HOME\",\n                \"VALUE\": \"{{ $json[\"Phone_Home\"] }}\",\n                \"TYPE_ID\": \"PHONE\"\n            },\n            {\n                \"ID\": \"{{ $json[\"Phone2\"] }}\",\n                \"VALUE_TYPE\": \"OTHER\",\n                \"VALUE\": \"{{ $json[\"Phone_Other\"]}}\",\n                \"TYPE_ID\": \"PHONE\"\n            }\n        ],\n        \"EMAIL\": [\n            {\n                \"ID\": \"{{ $json[\"Email\"] }}\",\n                \"VALUE_TYPE\": \"HOME\",\n                \"VALUE\": \"{{ $json[\"Home E-mail\"] }}\",\n                \"TYPE_ID\": \"EMAIL\"\n            }\n        ]\n\n    }\n}",
        "options": {}
      },
      "id": "07383e6d-48dd-4b82-bc99-a78c53130b66",
      "name": "HTTP Request5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        980,
        40
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "result",
        "include": "selectedOtherFields",
        "fieldsToInclude": "total",
        "options": {}
      },
      "id": "3c9aac28-d885-41a6-ab63-6e7ed2fbcc17",
      "name": "Item Lists1",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        -180,
        -160
      ]
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "Bitrix24ID",
              "stringValue": "={{ $json.result.ID }}"
            },
            {
              "name": "Phone",
              "type": "numberValue",
              "numberValue": "={{ $json.result.PHONE[0].ID }}"
            },
            {
              "name": "Phone1",
              "stringValue": "={{ $json.result.PHONE[1].ID }}"
            },
            {
              "name": "Phone2",
              "stringValue": "={{ $json.result.PHONE[2].ID }}"
            },
            {
              "name": "Email",
              "stringValue": "={{ $json.result.EMAIL[0].ID }}"
            }
          ]
        },
        "include": "none",
        "options": {}
      },
      "id": "1812aa96-1d1a-490b-9dd6-4f43b50688ff",
      "name": "Edit Fields5",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        500,
        -180
      ]
    },
    {
      "parameters": {
        "url": "https://nmnepic.bitrix24.com/rest/229/ovmu87rocingpwzg/crm.contact.get.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "={{ $json.result.ID }}"
            }
          ]
        },
        "options": {}
      },
      "id": "db19e5f0-fdd1-4d5f-be65-5827cbf114d9",
      "name": "HTTP Request6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        320,
        -180
      ]
    },
    {
      "parameters": {
        "content": "## Create Task in Bitrix24",
        "height": 232.70975056689326,
        "width": 308.5941043083901
      },
      "id": "b751f93c-0e99-4d05-9b1b-16097c30fa13",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        320,
        -580
      ]
    },
    {
      "parameters": {
        "content": "## Find the contact in Bitrix24 by MRN",
        "height": 271.1224489795917,
        "width": 556.9047619047619
      },
      "id": "e9049528-5ca8-4aa8-ae56-3b6accec865a",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -409,
        -263
      ]
    },
    {
      "parameters": {
        "content": "## If single match, move forward",
        "height": 223.1065759637188,
        "width": 388.1632653061224
      },
      "id": "707675bc-15f9-4534-b25c-bf77a1d203cf",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        280,
        -240
      ]
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n## Combine query and API call info",
        "height": 184.69387755102042,
        "width": 534.9546485260771
      },
      "id": "f6a01e30-1f55-4572-842b-9dbbeea0c98f",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        280,
        9.02494331065759
      ]
    },
    {
      "parameters": {
        "content": "## Update Bitrix24",
        "height": 220.36281179138325,
        "width": 219.42176870748298
      },
      "id": "ed3e97df-3216-431f-bd8d-c9654b2f056a",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        920,
        -20
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM public.deltadata FETCH FIRST ROW ONLY;\n",
        "options": {}
      },
      "id": "e92c5569-03b7-4687-89b6-4ed2f11ca0b0",
      "name": "Postgres6",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1320,
        40
      ],
      "credentials": {
        "postgres": {
          "id": "Q6RIpOzlSExUJy1c",
          "name": "Postgres n8nautoxl"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Delete Record",
        "height": 217.61904761904765,
        "width": 211.19047619047618
      },
      "id": "1a710217-3f52-4dfc-86c3-5c203eaca60b",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1280,
        -20
      ]
    },
    {
      "parameters": {
        "content": "## Delta Table:\nFETCH FIRST ROW",
        "height": 254.6598639455782,
        "width": 168.6621315192744
      },
      "id": "1ab0b0b8-fc95-4d48-a3eb-b57e141a3e28",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -620,
        -80
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "seconds",
              "secondsInterval": 0.3
            }
          ]
        }
      },
      "id": "6d74ec00-d9f4-4aad-925f-32403ee1da20",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -440,
        260
      ]
    }
  ],
  "pinData": {
    "Postgres5": [
      {
        "json": {
          "MRN": "000319",
          "First Name": "NICHOLAS",
          "Last Name": "STOCKER",
          "Date Of Birth": "11/07/1994",
          "Home E-mail": "nicholasanthonystocker@gmail.com",
          "Phone_Mobile": "+13135504087",
          "Phone_Home": "+13135504087",
          "Phone_Other": "+13135504087",
          "PatientMaritalStatus": "Single",
          "Patient_FirstDateRegistered_InPMSystem": "07/20/2009",
          "Patient_ActiveOrInactive_InPMSystem": "Active",
          "PatientGender": "M",
          "Street": "1907 VILLA ROAD",
          "City": "BIRMINGHAM",
          "State": "MI ",
          "ZipCode": "48009",
          "Guarantor_LastFirstName": "STOCKER, CHRISTOPHER",
          "Guarantor_Mobile": "000-000-0000",
          "Guarantor_HomePhone": "+12489906590",
          "PreferredContactMethod": "",
          "Total_Prior_AcknowledgedAppts": "2.0",
          "Last_Appt_Date_Acknowledged": "04/29/2020",
          "Show_rate_percentage": "0.33",
          "LastApptDate": "04/29/2020",
          "Last_Appointment_Provider_Seen": "Zuziak, Frank FNP-C",
          "Last_Appointment_Location_Visited": "EPIC VIDEO VISITS",
          "Carrier_InsurancePlan_Name": "HAP",
          "preferred_provider": "Grodzinskiy, Dina MS, PA-C",
          "PCareResourceAndLoc": "01/01/1900",
          "PCareFutureApptTime": "01/01/1900",
          "MammoFutureApptDT": "01/01/1900",
          "PTFutureApptDT": "01/01/1900",
          "CardFutureApptDT": "01/01/1900",
          "CMFutureApptDT": "01/01/1900",
          "BHFutureApptDT": "01/01/1900",
          "ColonFutureApptDT": "01/01/1900",
          "PharmFutureApptDT": "01/01/1900",
          "StressFutureApptDT": "01/01/1900",
          "EchoFutureApptDT": "01/01/1900",
          "GenUSFutureApptDT": "01/01/1900",
          "VascFutureApptDT": "01/01/1900",
          "SleepFutureApptDT": "01/01/1900",
          "CCM_Username": "NoCCMContactOnFile",
          "CCM_Last_Updated": "01/01/1900",
          "Source information": "000319",
          "CCM_Consent_Date_EMR": "01/01/1900"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "HTTP Request1": [
      {
        "json": {
          "result": [
            {
              "ID": "321523",
              "POST": null,
              "COMMENTS": null,
              "HONORIFIC": null,
              "NAME": "NICHOLAS",
              "SECOND_NAME": null,
              "LAST_NAME": "STOCKER",
              "PHOTO": null,
              "LEAD_ID": null,
              "TYPE_ID": "CLIENT",
              "SOURCE_ID": "OTHER",
              "SOURCE_DESCRIPTION": "319",
              "COMPANY_ID": null,
              "BIRTHDATE": "1994-11-07T03:00:00+03:00",
              "EXPORT": "Y",
              "HAS_PHONE": "Y",
              "HAS_EMAIL": "Y",
              "HAS_IMOL": "N",
              "DATE_CREATE": "2023-12-07T14:50:40+03:00",
              "DATE_MODIFY": "2023-12-10T15:10:54+03:00",
              "ASSIGNED_BY_ID": "229",
              "CREATED_BY_ID": "229",
              "MODIFY_BY_ID": "7",
              "OPENED": "Y",
              "ORIGINATOR_ID": null,
              "ORIGIN_ID": null,
              "ORIGIN_VERSION": null,
              "FACE_ID": null,
              "LAST_ACTIVITY_TIME": "2023-12-07T14:50:40+03:00",
              "ADDRESS": null,
              "ADDRESS_2": null,
              "ADDRESS_CITY": null,
              "ADDRESS_POSTAL_CODE": null,
              "ADDRESS_REGION": null,
              "ADDRESS_PROVINCE": null,
              "ADDRESS_COUNTRY": null,
              "ADDRESS_LOC_ADDR_ID": null,
              "UTM_SOURCE": null,
              "UTM_MEDIUM": null,
              "UTM_CAMPAIGN": null,
              "UTM_CONTENT": null,
              "UTM_TERM": null,
              "LAST_ACTIVITY_BY": "229"
            }
          ],
          "total": 1,
          "time": {
            "start": 1702584944.378861,
            "finish": 1702584944.661681,
            "duration": 0.2828199863433838,
            "processing": 0.2623109817504883,
            "date_start": "2023-12-14T23:15:44+03:00",
            "date_finish": "2023-12-14T23:15:44+03:00",
            "operating_reset_at": 1702585544,
            "operating": 0.2622950077056885
          }
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Postgres6": [
      {
        "json": {
          "MRN": "000319",
          "First Name": "NICHOLAS",
          "Last Name": "STOCKER",
          "Date Of Birth": "11/07/1994",
          "Home E-mail": "nicholasanthonystocker@gmail.com",
          "Phone_Mobile": "+13135504087",
          "Phone_Home": "+13135504087",
          "Phone_Other": "+13135504087",
          "PatientMaritalStatus": "Single",
          "Patient_FirstDateRegistered_InPMSystem": "07/20/2009",
          "Patient_ActiveOrInactive_InPMSystem": "Active",
          "PatientGender": "M",
          "Street": "1907 VILLA ROAD",
          "City": "BIRMINGHAM",
          "State": "MI ",
          "ZipCode": "48009",
          "Guarantor_LastFirstName": "STOCKER, CHRISTOPHER",
          "Guarantor_Mobile": "000-000-0000",
          "Guarantor_HomePhone": "+12489906590",
          "PreferredContactMethod": "",
          "Total_Prior_AcknowledgedAppts": "2.0",
          "Last_Appt_Date_Acknowledged": "04/29/2020",
          "Show_rate_percentage": "0.33",
          "LastApptDate": "04/29/2020",
          "Last_Appointment_Provider_Seen": "Zuziak, Frank FNP-C",
          "Last_Appointment_Location_Visited": "EPIC VIDEO VISITS",
          "Carrier_InsurancePlan_Name": "HAP",
          "preferred_provider": "Grodzinskiy, Dina MS, PA-C",
          "PCareResourceAndLoc": "01/01/1900",
          "PCareFutureApptTime": "01/01/1900",
          "MammoFutureApptDT": "01/01/1900",
          "PTFutureApptDT": "01/01/1900",
          "CardFutureApptDT": "01/01/1900",
          "CMFutureApptDT": "01/01/1900",
          "BHFutureApptDT": "01/01/1900",
          "ColonFutureApptDT": "01/01/1900",
          "PharmFutureApptDT": "01/01/1900",
          "StressFutureApptDT": "01/01/1900",
          "EchoFutureApptDT": "01/01/1900",
          "GenUSFutureApptDT": "01/01/1900",
          "VascFutureApptDT": "01/01/1900",
          "SleepFutureApptDT": "01/01/1900",
          "CCM_Username": "NoCCMContactOnFile",
          "CCM_Last_Updated": "01/01/1900",
          "Source information": "000319",
          "CCM_Consent_Date_EMR": "01/01/1900"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2023-12-14T22:21:09.510Z",
  "versionId": "9861d91c-8013-4e26-98d6-ccb7572c7d73"
}